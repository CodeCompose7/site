{{- /*
  섹션 루트(page)와 섹션 이름을 일관되게 찾아주는 헬퍼.
  우선순위:
    1) 호출 시 넘긴 .section
    2) 페이지 front matter 의 .Params.sectionKey
    3) 현재 페이지의 .Section
    4) 사이트 설정 .Site.Params.sections.default (없으면 "blog")
  언어별 경로(/{lang}/{section}) → /{section} → section 타입 순으로 찾는다.
  반환: dict { "name": <sectionName>, "page": <sectionPage or nil> }
*/ -}}
{{- $context := .context | default . }}
{{- $sectionName := .section | default (
    $context.Params.sectionKey | default (
      $context.Section | default (
        $context.Site.Params.sections.default | default "blog"
      )
    )
  )
}}
{{- $currentLang := $context.Language.Lang | default "ko" }}
{{- $sectionPage := .sectionPage }}

{{- /* 1) /{lang}/{section} */}}
{{- if not $sectionPage }}
  {{- $path := printf "/%s/%s" $currentLang $sectionName }}
  {{- $found := $context.Site.GetPage $path }}
  {{- if and $found (ne $found $context) }}
    {{- $sectionPage = $found }}
  {{- end }}
{{- end }}

{{- /* 2) /{section} */}}
{{- if not $sectionPage }}
  {{- $found := $context.Site.GetPage (printf "/%s" $sectionName) }}
  {{- if and $found (ne $found $context) }}
    {{- $sectionPage = $found }}
  {{- end }}
{{- end }}

{{- /* 3) section 타입 */}}
{{- if not $sectionPage }}
  {{- $found := $context.Site.GetPage "section" $sectionName }}
  {{- if and $found (ne $found $context) }}
    {{- $sectionPage = $found }}
  {{- end }}
{{- end }}

{{- return (dict "name" $sectionName "page" $sectionPage) }}

